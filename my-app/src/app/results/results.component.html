<section>
<nav>
    <button mat-button 
        (click)="location.back()" 
        aria-label="Back to previous">
        <mat-icon >chevron_left</mat-icon> 
        Back to previous
    </button>

    <button class="summary" 
        *ngIf="parameters | async as parameters"
        mat-button 
        (click)="navigateToSummary()" 
        aria-label="Go to summary">
        Go to summary
        <mat-icon >chevron_right</mat-icon> 
    </button>
</nav>

<ng-container *ngIf="visiblePreferences | async as visiblePreferences">
    <dl *ngIf="visiblePreferences.length > 0">
        <details>
            <summary>
                Updated model parameters ({{visiblePreferences.length}})
            </summary>
            <ng-container *ngFor="let preference of visiblePreferences">
                <dt>{{toFriendlyText(preference.key)}}</dt><dd>{{preference.value}}</dd>
            </ng-container>

            <div>
                <a mat-stroked-button [routerLink]="routingService.mapper.createSimulationParameterCollectionRoute()">
                    Modify number of simulations ({{findMyRetirementService.retirementPreferences.numWorkingSimulations}})
                </a>
            </div>
        </details>
    </dl>
</ng-container>

<div class="metrics" *ngIf="findMyRetirementService.summary | async as summary">
    <div>
        <span>Expected Outcome</span>
        <span>{{summary.medianOutcome}}</span>
    </div>
    <div>
        <span>Time in Years</span>
        <span>{{summary.time}}</span>
    </div>
    <div>
        <span>Confidence to Target</span>
        <span>{{summary.confidence}}</span>
    </div>
    <div>
        <span>Target Nest Egg</span>
        <span>{{summary.value}}</span>
    </div>
</div>

<div class="metrics" *ngIf="findMyRetirementService.metrics | async as metrics">
    <tbody>
        <tr *ngFor="let metric of metrics;let i = index">
            <td>{{metric.title}}</td>
            <td>{{metric.value}}</td>
        </tr>
    </tbody>
</div>

    <ng-container *ngIf="working | async as working;else loading">
        <div>
            Working
            <a mat-stroked-button [routerLink]="routingService.mapper.createWorkingParameterCollectionRoute()">
                Modify parameters
            </a>
        </div>
            
        <app-line-chart 
            [chartData]="working" 
            [legend]="{show:false}"
            [gridOptions]="findMyRetirementService.workingGridOptions"></app-line-chart>
        
    </ng-container>
    <details *ngIf="findMyRetirementService.simulations | async as simulations">
        <summary>
            Data table (Representative sample)
        </summary>

        <table>
            <tbody>
                <tr *ngFor="let simulation of simulations;let i = index">
                    <td>{{i*5}} percentile</td>
                    <td>{{simulation[simulation.length-1]}}</td>
                </tr>
            </tbody>
        </table>    
    </details>
    
    <ng-container *ngIf="retirement | async as retirement">
        
    <div>
        Retirement
        <a mat-stroked-button [routerLink]="routingService.mapper.createRetirementParameterCollectionRoute()">
            Modify parameters
        </a>
    </div>
    <app-line-chart [chartData]="retirement" 
        [gridOptions]="findMyRetirementService.retirementGridOptions"></app-line-chart>
    </ng-container>
    
<br/>
<div>
    <button class="summary" 
    color="primary"
    *ngIf="parameters | async as parameters"
    mat-flat-button 
    (click)="navigateToSummary()" 
    aria-label="Go to summary">
    Go to summary
<mat-icon >chevron_right</mat-icon> 
</button>
</div>

</section>


<ng-template #loading>Running simulations...</ng-template>